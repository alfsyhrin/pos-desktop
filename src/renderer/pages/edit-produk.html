<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Edit Produk</title>
  <link rel="stylesheet" href="../css/tambah-produk.css">
</head>
<body>
  <header>
    <div class="back-button">
        <a href="#" onclick="loadPage('produk'); return false;">
            <span class="material-symbols-outlined">arrow_back</span>
        </a>
    </div>
    <div class="judul-header">
      <h3>Edit Produk</h3>
    </div>
  </header>
  <div class="main-container">
    <form id="form-edit-produk">
      <input type="hidden" id="product-id">
      
      <div class="form-group">
        <label>Nama Produk</label>
        <input type="text" id="nama-produk" required>
      </div>

      <div class="form-group">
        <label>SKU</label>
        <input type="text" id="sku">
      </div>

      <!-- TAMBAH: Barcode field (read-only) -->
      <div class="form-group">
        <label>Barcode</label>
        <input type="text" id="barcode" readonly style="background-color: #333; color: #999; cursor: not-allowed;">
        <small style="color: #999;">* Tidak dapat diubah</small>
      </div>

      <!-- TAMBAH: Harga Modal -->
      <div class="form-group">
        <label>Harga Modal</label>
        <input type="text" id="harga-modal" class="rupiah-input" placeholder="Rp 0">
      </div>

      <div class="form-group">
        <label>Harga Jual</label>
        <input type="text" id="harga-jual" class="rupiah-input" placeholder="Rp 0">
      </div>

      <div class="form-group">
        <label>Stok</label>
        <input type="number" id="stok">
      </div>

      <div class="form-group">
        <label>Upload Gambar Produk (opsional)</label>
        <input type="file" id="product-image" accept="image/*">
      </div>

      <div class="form-group">
        <label>Aktif?</label>
        <select id="is-active">
          <option value="true">Ya</option>
          <option value="false">Tidak</option>
        </select>
      </div>

      <div class="form-group">
        <label>Tipe Promo</label>
        <select id="promo-type" onchange="handlePromoChangeEdit()">
          <option value="">Tidak ada promo</option>
          <option value="percentage">Diskon Persen (%)</option>
          <option value="amount">Potong Harga (Rp)</option>
          <option value="buyxgety">Beli X Gratis Y</option>
          <option value="bundle">Diskon Paket</option>
        </select>
      </div>

      <div class="form-group" id="promo-percent-wrapper" style="display:none;">
        <label>Promo Percent (%)</label>
        <input type="number" id="promo-percent" placeholder="Contoh: 10">
      </div>

      <div class="form-group" id="promo-amount-wrapper" style="display:none;">
        <label>Promo Amount (Rp)</label>
        <input type="number" id="promo-amount" placeholder="Contoh: 2000">
      </div>

      <div class="form-group" id="buyxgety-wrapper" style="display:none;">
        <label>Beli Qty (X)</label>
        <input type="number" id="buy-qty" placeholder="Contoh: 2">
        <label>Gratis Qty (Y)</label>
        <input type="number" id="free-qty" placeholder="Contoh: 1">
      </div>

      <div class="form-group" id="bundle-wrapper" style="display:none;">
        <label>Bundle Qty</label>
        <input type="number" id="bundle-qty" placeholder="Contoh: 3">
        <label>Bundle Total Price</label>
        <input type="number" id="bundle-total-price" placeholder="Contoh: 5000">
      </div>

      <div class="action-buttons">
        <button type="submit" class="btn btn-success">Simpan Perubahan</button>
      </div>
    </form>
  </div>

  <script src="../js/notifications.js"></script>
  <script src="../js/api.js"></script>
  <script src="../js/edit-produk.js"></script>
  <script>
function formatRupiahInput(val) {
  const num = String(val).replace(/\D/g, '');
  if (!num) return '';
  return num.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
}
function parseRupiahInput(val) {
  return Number(String(val).replace(/\./g, '').replace(/[^0-9]/g, '')) || 0;
}
function initRupiahInput(input) {
  if (!input) return;
  input.type = "text";
  input.inputMode = "numeric";
  input.addEventListener('input', function () {
    let val = this.value.replace(/\D/g, '');
    this.value = formatRupiahInput(val);
  });
  input.addEventListener('blur', function () {
    let val = this.value.replace(/\D/g, '');
    this.value = formatRupiahInput(val);
  });
  input.addEventListener('focus', function () {
    let val = this.value.replace(/\D/g, '');
    this.value = val;
  });
}
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.rupiah-input').forEach(initRupiahInput);
});
</script>
</body>
</html>